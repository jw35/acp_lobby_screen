<!doctype html>

<html>

  <head>
    <title>ijl20 test v2.03</title>

    <script src="rtmonitor_api.js" type="text/javascript"></script>

    <link rel="stylesheet" href="lobby_screen.css">
    <link rel="stylesheet" href="stop_timetable.css">
    <link rel="stylesheet" href="/lobby_screen/static/stop_bus_map/stop_bus_map.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>

    <script src="/lobby_screen/static/js/MovingMarker.js" type="text/javascript"></script>

    <script src="/lobby_screen/static/js/Semicircle.js" type="text/javascript"></script>

    <script src="/lobby_screen/static/js/geo.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="/lobby_screen/static/js/moment-with-locales.min.js"></script>
    <script src="/lobby_screen/static/js/moment-timezone-with-data.min.js"></script>
    <script src="stop_timetable_ijl20.js" type="text/javascript"></script>

    <script src="/lobby_screen/static/stop_bus_map/stop_bus_map.js" type="text/javascript"></script>
    <script type="text/javascript">

      var DEBUG = '';//'stop_timetable_log stop_bus_map_log rtmonitor_api_log'; // widget.log() code will check this var

      var RTMONITOR_API;

      var widget = [];

      widget.push(new StopTimetable('stop_timetable_1',
                                 { id: 'stop_timetable_1', 
                                   static_url: '/lobby_screen/static',
                                   title: 'William Gates Building "U"', 
                                   stop_id: '0500CCITY424', 
                                   common_name: 'William Gates Building',
                                   lat: 52.21129, 
                                   lng: 0.09107
                                 }));

      widget.push(new StopTimetable('stop_timetable_2',
                                 { id: 'stop_timetable_2', 
                                   static_url: '/lobby_screen/static',
                                   title: 'Cam Uni Vet School', 
                                   stop_id: '0500CCITY199', 
                                   common_name: 'Cam Uni Vet School',
                                   lat: 52.21129, 
                                   lng: 0.09107
                                 }));

      widget.push(new StopTimetable('stop_timetable_3',
                                 { id: 'stop_timetable_3', 
                                   static_url: '/lobby_screen/static',
                                   title: 'Christ\'s College', 
                                   stop_id: '0500CCITY111', 
                                   common_name: 'Christ\'s College',
                                   lat: 52.21129, 
                                   lng: 0.09107
                                 }));

      widget.push(new StopTimetable('stop_timetable_4',
                                 { id: 'stop_timetable_4', 
                                   static_url: '/lobby_screen/static',
                                   title: 'Fire Station', 
                                   stop_id: '0500CCITY308', 
                                   common_name: 'Fire Station',
                                   lat: 52.20305, 
                                   lng: 0.13162
                                 }));

      widget.push(new StopTimetable('stop_timetable_5',
                                 { id: 'stop_timetable_5', 
                                   static_url: '/lobby_screen/static',
                                   title: 'Driving Test Centre', 
                                   stop_id: '0500CCITY528', 
                                   common_name: 'Driving Test Centre',
                                   lat: 52.23059, 
                                   lng: 0.15139
                                 }));

      widget.push(new StopBusMap('stop_bus_map_1',
                                 { id: 'stop_bus_map_1', 
                                   static_url: '/lobby_screen/static',
                                   title: 'Live Buses: U and Citi4', 
                                   stops: [ { stop_id: '0500CCITY424',
                                              common_name: 'William Gates Building',
                                              lat: 52.21129,
                                              lng: 0.09107
                                            },
                                            { stop_id: '0500CCITY199',
                                              common_name: 'Cam Uni Vet School',
                                              lat: 52.21297,
                                              lng: 0.09062
                                            }
                                          ],
                                   breadcrumbs: true,
                                   lat: 52.215, 
                                   lng: 0.09, 
                                   zoom: 15 }));

      function reload_widgets () {
        for (var i = 0; i < widget.length; i++) {
          if ('reload' in widget[i]) {
            //console.log("Reloading ", widget[i].container);
            widget[i].reload();
          }
          else {
            //console.log("Not reloading ", widget[i].container);
          }
        }
      }

      function page_load() {

        // Note we must instatiate RTMonitorAPI before widgets
        RTMONITOR_API = new RTMonitorAPI();
    
        for (var i = 0; i < widget.length; i++) {
          if ('init' in widget[i]) {
            console.log("Initing ", widget[i].container);
            widget[i].init();
          }
          else {
            console.log("Not initing ", widget[i].container);
          }
        }

        // Now we know widgets have run 'init', we can tell RTMonitorAPI to connect and tell those widgets
        RTMONITOR_API.init();

        setInterval(function() {
            //console.log("Running page-level reloader");
            reload_widgets();
        }, 60000);

        setInterval(update_screen_clock, 1000);
      }

      function update_screen_clock() {
        var datetime = new Date();
        var hh = ('0'+datetime.getHours()).slice(-2);
        var mm = ('0'+datetime.getMinutes()).slice(-2);
        var ss = ('0'+datetime.getSeconds()).slice(-2);
        document.getElementById('screen_clock').innerHTML = hh+':'+mm+':'+ss;
      }

    </script>

  </head>

  <body onLoad="page_load()">

    <div class="wrapper">
      <div class="credits">
        <div id="screen_clock"></div>

        <a href="http://www.connectingcambridgeshire.co.uk/smartcamb/">
            <img alt="Connecting Cambridgshire" src="/lobby_screen/static/logo_sc_112.png" >
        </a>
        <a href="http://www.cam.ac.uk">
            <img alt="The University of Cambridge" src="/lobby_screen/static/logo_uc_112.png">
        </a>
        <span>Adaptive Cities Platform</span>
      </div>

      <div class="container_2_2 col_1 row_1" id="stop_timetable_1">
      </div>
      <div class="container_2_2 col_3 row_1" id="stop_timetable_2">
      </div>
      <div class="container_2_2 col_5 row_1" id="stop_timetable_3">
      </div>
      <div class="container_2_2 col_1 row_3" id="stop_timetable_4">
      </div>
      <div class="container_2_2 col_3 row_3" id="stop_timetable_5">
      </div>
      <div class="container_2_2 col_5 row_3" id="stop_bus_map_1">
      </div>

    </div>

  </body>

</html>
