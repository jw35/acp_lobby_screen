<!doctype html>

<html>

  <head>
    <title>ACP Lobby Screen</title>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAEkMI-ZAAt1kjv668jfBXhNB1-odv5m3g"></script>


    {% include 'leaflet.html' %}

    {% include 'sockjs.html' %}

    <!-- For the twitter_timeline widget -->
    <script src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

    <!-- Widget stylesheets -->
    <link rel="stylesheet" href="{{ url_for('static', filename='lobby_screen.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='station_board/station_board.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='message_area/message_area.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='iframe_area/iframe_area.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='stop_bus_map/stop_bus_map.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='weather/weather.css') }}">

    <!-- Widget Javascript -->
    <script src="{{ url_for('static', filename='station_board/station_board.js') }}" type="text/javascript">
    </script>
    <script src="{{ url_for('static', filename='traffic_map/traffic_map.js') }}" type="text/javascript">
    </script>
    <script src="{{ url_for('static', filename='message_area/message_area.js') }}" type="text/javascript">
    </script>
    <script src="{{ url_for('static', filename='iframe_area/iframe_area.js') }}" type="text/javascript">
    </script>
    <script src="{{ url_for('static', filename='stop_bus_map/stop_bus_map.js') }}" type="text/javascript">
    </script>
    <script src="{{ url_for('static', filename='weather/weather.js') }}" type="text/javascript">
    </script>
    <script src="{{ url_for('static', filename='twitter_timeline/twitter_timeline.js') }}" type="text/javascript"></script>

    <script type="text/javascript">

      var DEBUG = ''; // widget.log() code will check this global variable

      // Widget instantiation

      var widget = [];

      widget.push(new MessageArea('message_area_1',{message: `
<h1>Lobby Screen</h1>

<p>This is an early preview of an <em>Adaptive Cities</em> <strong>Lobby Screen</strong>.
These screens display real-time travel information in the lobbies of
public buildings to inform travel choices.</p>

<p>Screens are geo-located to automatically display relevant information
and can be further customised by local managers &ndash; this is an
example of a locally-configured static message.</p>

<p>Lobby Screens are under active development, but they can already display:</p>

<ul>
  <li>Bus movements</li>
  <li>Train departure times</li>
  <li>Google traffic maps</li>
  <li>Weather forecasts</li>
  <li>Twitter timelines</li>
  <li>Static messages</li>
  <li>Other web pages</li>
</ul>
`     }))

      widget.push(new Weather('weather_area_1', {location: '310042'}))

      widget.push(new StopBusMap('stop_bus_map_1',
                                 { id: 'stop_bus_map_1', 
                                   static_url: '/lobby_screen/static',
                                   title: 'Live Buses: U and Citi4', 
                                   stop_id: 'XXYYZZ', 
                                   breadcrumbs: true,
                                   lat: 52.215, 
                                   lng: 0.09, 
                                   zoom: 15 }));

      widget.push(new StationBoard('station_board_1',{station: 'CBG', offset: 0}));
      widget.push(new StationBoard('station_board_2',{station: 'CMB', offset: 0}));

      widget.push(new TwitterTimeline('twitter_timeline_1',{who: 'Cambs_Traffic'}));

      widget.push(new TrafficMap('traffic_map_1', {lat: 52.204684, lng: 0.124622, zoom: 10}));
      widget.push(new TrafficMap('traffic_map_2', {lat: 52.204684, lng: 0.124622, zoom: 12}));

      // Generic framework - init and refresh handling

      function reload_widgets () {
        for (var i = 0; i < widget.length; i++) {
          if ('reload' in widget[i]) {
            console.log("Reloading ", widget[i].container);
            widget[i].reload();
          }
          else {
            console.log("Not reloading ", widget[i].container);
          }
        }
      }

      function page_load() {
        for (var i = 0; i < widget.length; i++) {
          if ('init' in widget[i]) {
            console.log("Initing ", widget[i].container);
            widget[i].init();
          }
          else {
            console.log("Not initing ", widget[i].container);
          }
        }
        setInterval(function() {
          console.log("Running page-level reloader");
          reload_widgets();
        }, 60000)
      }

    </script>

  </head>

  <body onLoad="page_load()">

    <!-- Widget display area definition -->

    <div class="wrapper">

      <div class="container_1_2 col_1 row_1" id="message_area_1">
        <img class="spinner" src="{{ url_for('static', filename='indicator-lite.gif') }}" alt=""/>
      </div>

      <div class="container_1_2 col_1 row_3" id="weather_area_1">
        <img class="spinner" src="{{ url_for('static', filename='indicator-lite.gif') }}" alt=""/>
      </div>

      <div class="container_2_2 col_5 row_1" id="stop_bus_map_1">
        <img class="spinner" src="{{ url_for('static', filename='indicator-lite.gif') }}" alt=""/>
      </div>

      <div class="container_1_2 col_5 row_3" id="station_board_1">
        <img class="spinner" src="{{ url_for('static', filename='indicator-lite.gif') }}" alt=""/>
      </div>
      <div class="container_1_2 col_6 row_3" id="station_board_2">
        <img class="spinner" src="{{ url_for('static', filename='indicator-lite.gif') }}" alt=""/>
      </div>

      <div class="container_2_2 col_2 row_1" id="traffic_map_1">
        <img class="spinner" src="{{ url_for('static', filename='indicator-lite.gif') }}" alt=""/>
      </div>
      <div class="container_2_2 col_2 row_3" id="traffic_map_2">
        <img class="spinner" src="{{ url_for('static', filename='indicator-lite.gif') }}" alt=""/>
      </div>

      <div class="container_1_4 col_4 row_1" id="twitter_timeline_1">
        <img class="spinner" src="{{ url_for('static', filename='indicator-lite.gif') }}" alt=""/>
      </div>

      <div class="credits">
        <a href="https://www.greatercambridge.org.uk/"><img alt="Greater Cambridge Partnership" src="{{ url_for('static', filename='logo_gccd_112.png') }}"></a>
        <a href="http://www.connectingcambridgeshire.co.uk/smartcamb/"><img alt="Connecting Cambridgshire" src="{{ url_for('static', filename='logo_sc_112.png') }}" ></a>
        <a href="http://www.cam.ac.uk"><img alt="The University of Cambridge" src="{{ url_for('static', filename='logo_uc_112.png') }}"></a>
        <span>Adaptive Cities Platform</span>
      </div>

    </div>

  </body>

</html>
